# run tests using the binary built before
test:
  stage: test
  script:
    - make check
    
debian_test:
  stage: deploy
  script: 
    - rm -f *.{deb,dsc,changes}
    - dpkg-buildpackage --no-sign
    - mv ../subverb_*.{deb,dsc,changes} .
  artifacts:
    paths: 
      - "*.deb"
      - "*.dsc"
      - "*.changes"
    when: on_success
  only:
    - master

debian_upload:
  stage: deploy
  script:
    - rm ../subverb_*.{deb,dsc,changes}
    - dpkg-buildpackage
    - reprepro includedeb experimental ../subverb_*.deb
    - reprepro includedsc experimental ../subverb_*.dsc
  only:
    - master
  when: manual
